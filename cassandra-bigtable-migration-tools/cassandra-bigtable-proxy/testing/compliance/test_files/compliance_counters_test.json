[
  {
    "title": "Basic Counter and Validation Test",
    "description": "",
    "kind": "dml",
    "operations": [
      {
        "query": "INSERT INTO bigtabledevinstance.social_posts (user_id, id, likes) VALUES (?, ?, ?)",
        "query_desc": "TODO insert. not sure what cassandra does",
        "query_type": "INSERT",
        "params": [
          {
            "value": "user123",
            "datatype": "text"
          },
          {
            "value": 30,
            "datatype": "int"
          },
          {
            "value": 0,
            "datatype": "bigint"
          }
        ],
        "expected_result": null
      },
      {
        "query": "SELECT user_id, id, likes FROM bigtabledevinstance.social_posts WHERE user_id = ? AND id = ?",
        "query_type": "SELECT",
        "query_desc": "",
        "params": [
          {
            "value": "user123",
            "datatype": "text"
          },
          {
            "value": 30,
            "datatype": "int"
          }
        ],
        "expected_result": [
          {
            "value": "user123",
            "datatype": "text"
          },
          {
            "value": 30,
            "datatype": "int"
          },
          {
            "value": 0,
            "datatype": "bigint"
          }
        ]
      },
      {
        "query": "UPDATE bigtabledevinstance.social_posts set likes = likes + 2 WHERE user_id = ? AND id = ?",
        "query_type": "UPDATE",
        "query_desc": "increment likes",
        "params": [
          {
            "value": "user123",
            "datatype": "text"
          },
          {
            "value": 30,
            "datatype": "int"
          }
        ],
        "expected_result": null
      },
      {
        "query": "SELECT user_id, id, likes FROM bigtabledevinstance.social_posts WHERE user_id = ? AND id = ?",
        "query_type": "SELECT",
        "query_desc": "",
        "params": [
          {
            "value": "user123",
            "datatype": "text"
          },
          {
            "value": 30,
            "datatype": "int"
          }
        ],
        "expected_result": [
          {
            "value": "user123",
            "datatype": "text"
          },
          {
            "value": 30,
            "datatype": "int"
          },
          {
            "value": 2,
            "datatype": "bigint"
          }
        ]
      }
    ],
    "success_message": "",
    "failure_message": ""
  },
  {
    "title": "Increment a counter with 0",
    "description": "increment counter",
    "kind": "dml",
    "operations": [
      {
        "query": "UPDATE bigtabledevinstance.social_posts set likes = likes + 0 WHERE user_id = ? AND id = ?",
        "query_type": "UPDATE",
        "params": [
          {
            "value": "userABC",
            "datatype": "text"
          },
          {
            "value": 1,
            "datatype": "int"
          }
        ],
        "expected_result": null
      },
      {
        "query": "SELECT likes FROM bigtabledevinstance.social_posts WHERE user_id = ? AND id = ?",
        "query_type": "SELECT",
        "query_desc": "",
        "params": [
          {
            "value": "userABC",
            "datatype": "text"
          },
          {
            "value": 1,
            "datatype": "int"
          }
        ],
        "expected_result": [
          {
            "likes": 0,
            "datatype": "bigint"
          }
        ]
      }
    ],
    "success_message": "",
    "failure_message": ""
  },
  {
    "title": "Increment a counter",
    "description": "increment counter",
    "kind": "dml",
    "operations": [
      {
        "query": "UPDATE bigtabledevinstance.social_posts set likes = likes + 2 WHERE user_id = ? AND id = ?",
        "query_type": "UPDATE",
        "params": [
          {
            "value": "userABC",
            "datatype": "text"
          },
          {
            "value": 1,
            "datatype": "int"
          }
        ],
        "expected_result": null
      },
      {
        "query": "UPDATE bigtabledevinstance.social_posts set likes = likes + 3 WHERE user_id = ? AND id = ?",
        "query_type": "UPDATE",
        "params": [
          {
            "value": "userABC",
            "datatype": "text"
          },
          {
            "value": 1,
            "datatype": "int"
          }
        ],
        "expected_result": null
      },
      {
        "query": "UPDATE bigtabledevinstance.social_posts set likes = likes - 1 WHERE user_id = ? AND id = ?",
        "query_type": "UPDATE",
        "params": [
          {
            "value": "userABC",
            "datatype": "text"
          },
          {
            "value": 1,
            "datatype": "int"
          }
        ],
        "expected_result": null
      },
      {
        "query": "SELECT likes FROM bigtabledevinstance.social_posts WHERE user_id = ? AND id = ?",
        "query_type": "SELECT",
        "query_desc": "",
        "params": [
          {
            "value": "userABC",
            "datatype": "text"
          },
          {
            "value": 1,
            "datatype": "int"
          }
        ],
        "expected_result": [
          {
            "likes": 4,
            "datatype": "bigint"
          }
        ]
      }
    ],
    "success_message": "",
    "failure_message": ""
  },
  {
    "title": "Set counter fails",
    "description": "Setting a counter should fail",
    "kind": "dml",
    "operations": [
      {
        "query": "UPDATE bigtabledevinstance.social_posts SET likes = ? WHERE user_id = ? AND id = ?",
        "query_desc": "Setting a counter which isn't allowed",
        "query_type": "UPDATE",
        "params": [
          {
            "value": "userXYZ",
            "datatype": "text"
          },
          {
            "value": 0,
            "datatype": "int"
          },
          {
            "value": 0,
            "datatype": "bigint"
          }
        ],
        "expected_result": [
          {
            "expect_error": true,
            "error_message": "Cannot set the value of counter column likes (counters can only be incremented/decremented, not set)"
          }
        ]
      }
    ],
    "success_message": "",
    "failure_message": ""
  },
  {
    "title": "Insert counter row",
    "description": "Insert a row should fail",
    "kind": "dml",
    "operations": [
      {
        "query": "INSERT INTO bigtabledevinstance.social_posts (user_id, id) VALUES (?, ?)",
        "query_type": "INSERT",
        "params": [
          {
            "value": "userXYZ",
            "datatype": "text"
          },
          {
            "value": 0,
            "datatype": "int"
          }
        ],
        "expected_result": [
          {
            "expect_error": true,
            "error_message": "INSERT statements are not allowed on counter tables, use UPDATE instead"
          }
        ]
      }
    ],
    "success_message": "Insert failed as expected",
    "failure_message": "Inserts should fail because it's a counter table"
  }
]